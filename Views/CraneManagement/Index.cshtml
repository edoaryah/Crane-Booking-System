<!-- Views/CraneManagement/Index.cshtml -->
@model IEnumerable<AspnetCoreMvcFull.ViewModels.CraneManagement.CraneViewModel>
@{
  ViewData["Title"] = "Crane Management";
  Layout = "_ContentNavbarLayout";
}

<div class="card mb-4">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">Crane Management</h5>
    <a href="@Url.Action("Create")" class="btn btn-primary">
      <i class="bx bx-plus me-1"></i> Add New Crane
    </a>
  </div>
  <div class="card-body">
    <div id="alertContainer">
      @if (ViewBag.SuccessMessage != null)
      {
        <div class="alert alert-success alert-dismissible fade show auto-close-alert" role="alert">
          @ViewBag.SuccessMessage
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      }

      @if (ViewBag.ErrorMessage != null)
      {
        <div class="alert alert-danger alert-dismissible fade show auto-close-alert" role="alert">
          @ViewBag.ErrorMessage
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      }
    </div>

    <!-- Crane Cards -->
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      @foreach (var crane in Model)
      {
        <div class="col">
          <div class="card h-100 crane-card">
            <div class="card-header">
              <h5 class="card-title mb-0">@crane.Code</h5>
            </div>

            <!-- Card Image -->
            <div class="crane-image-container">
              @if (!string.IsNullOrEmpty(crane.ImagePath))
              {
                <img src="@crane.ImagePath" class="card-img-top" alt="@crane.Code"
                  style="object-fit: cover; height: 100%; width: 100%;" />
              }
              else
              {
                <div class="d-flex justify-content-center align-items-center bg-light h-100">
                  <div class="text-center">
                    <i class="bx bx-image-alt fs-1 text-muted"></i>
                    <p class="text-muted mb-0">No image uploaded</p>
                  </div>
                </div>
              }

              <!-- Status Badge -->
              <div class="status-badge">
                @if (crane.Status == AspnetCoreMvcFull.Models.CraneStatus.Available)
                {
                  <span class="badge bg-success rounded px-3 py-2">
                    <i class="bx bx-check-circle me-1"></i> Available
                  </span>
                }
                else
                {
                  <span class="badge bg-danger rounded px-3 py-2">
                    <i class="bx bx-x-circle me-1"></i> Maintenance
                  </span>
                }
              </div>
            </div>

            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <div>
                  <span class="badge bg-primary rounded">@crane.Capacity Ton</span>
                </div>
                <div>
                  <span class="badge bg-info rounded">@crane.Ownership</span>
                </div>
              </div>

              <div class="d-grid gap-2">
                <a href="@Url.Action("Details", new { id = crane.Id })" class="btn btn-outline-primary btn-sm mb-2">
                  <i class="bx bx-show-alt me-1"></i> View Details
                </a>

                <div class="btn-group" role="group">
                  <a href="@Url.Action("Edit", new { id = crane.Id })" class="btn btn-outline-warning btn-sm">
                    <i class="bx bx-edit-alt me-1"></i> Edit
                  </a>
                  <a href="@Url.Action("Delete", new { id = crane.Id })" class="btn btn-outline-danger btn-sm">
                    <i class="bx bx-trash me-1"></i> Delete
                  </a>
                  <a href="@Url.Action("Index", "BreakdownHistory", new { craneId = crane.Id })"
                    class="btn btn-outline-info btn-sm">
                    <i class="bx bx-history me-1"></i> History
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      }
      @if (!Model.Any())
      {
        <div class="col-12">
          <div class="alert alert-info text-center">
            <i class="bx bx-info-circle fs-3 mb-2"></i>
            <p>No cranes found. Click "Add New Crane" to create one.</p>
          </div>
        </div>
      }
    </div>
  </div>
</div>

@section PageStyles {
  <style>
    .crane-card {
      transition: all 0.3s ease;
    }

    .crane-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    }

    .btn-group .btn {
      flex: 1;
    }

    .crane-image-container {
      height: 200px;
      overflow: hidden;
      position: relative;
    }

    .status-badge {
      position: absolute;
      bottom: 0;
      left: 0;
      margin: 0.75rem;
      z-index: 10;
    }
  </style>
}

@section PageScripts {
  <script>
    // Script untuk menghilangkan alert secara otomatis setelah 5 detik
    $(document).ready(function () {
      setTimeout(function () {
        $('.auto-close-alert').fadeOut('slow', function () {
          $(this).remove();
        });
      }, 5000); // 5000 milliseconds = 5 detik
    });
  </script>
}
